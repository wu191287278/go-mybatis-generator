package main

import (
    "database/sql"
    "github.com/fvbock/endless"
	"github.com/gin-gonic/gin"
    _ "github.com/go-sql-driver/mysql"
    "log"
    . "{{{artifact}}}/controller"
    . "{{{artifact}}}/repository"
    . "{{{artifact}}}/service"
)

func main() {
	db, _ := sql.Open("mysql", "{{{dataSource.username}}}:{{{dataSource.password}}}@({{{dataSource.host}}}:{{{dataSource.port}}})/{{{dataSource.dbName}}}")
	defer db.Close()

{{#tables}}
	{{lowerDomainName}}Repository := New{{domainName}}Repository(db)
{{/tables}}

{{#tables}}
    {{lowerDomainName}}Service := New{{domainName}}Service({{lowerDomainName}}Repository)
{{/tables}}

{{#tables}}
    {{lowerDomainName}}Controller := New{{domainName}}Controller({{lowerDomainName}}Service)
{{/tables}}

    r := gin.Default()

{{#tables}}
	{{lowerDomainName}} := r.Group("{{lowerDomainName}}")
    {
        {{lowerDomainName}}.GET("/search", {{lowerDomainName}}Controller.Search)
	    {{lowerDomainName}}.POST("/", {{lowerDomainName}}Controller.InsertSelective)
    {{#hasPrimaryKey}}
	    {{lowerDomainName}}.PUT("/", {{lowerDomainName}}Controller.UpdateByPrimaryKeySelective)
    {{/hasPrimaryKey}}
        }

{{/tables}}

    err := endless.ListenAndServe(":8080", r)
    if err != nil {
        log.Fatal(err)
    }
}
